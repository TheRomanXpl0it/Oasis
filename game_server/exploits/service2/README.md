# Polls

## Description

This service allows user to register, login and then create polls, with possibility to vote in them and share them to friends.

## Vulnerabilities

### Vuln 1 - Bad check in poll sharing

The `if not poll_dict["owner"]:` in the `share_poll` function is obviously wrong: we need to check something like `poll_dict["owner"] != user` to ensure that the token issuer is actually the poll owner. Thus, everyone can create sharing tokens for polls.

[Full exploit here](service2-sharing.py)

### Vuln 2 - Static token key

In `utils.py` there is a fixed key: `server_key = b"16_r4ndom_bytes!"`. This key is used to generate tokens, so knowing it we can craft valid tokens locally and share polls to ourselves. To patch just change the key.

[Full exploit here](service2-key.py)

### Vuln 3 - Tracebacks

All the exceptions are handled with the `rich.console.Console` module, using `console.print_exception(show_locals = True)`. As the name suggests, this functions prints the traceback _and_ shows the locals. You can use this to exploit whatever you want: if some secret information is in the locals, you can make the service throw an exception and read it. An example reading the `server_key` is given in the exploit (but the only limitation here is your creativity!). To patch, just remove the `show_locals = True` _or_ handle exceptions in a smarter way.

[Full exploit here](service2-traceback.py)

### Vuln 4 - Bitflipping in tokens

Tokens are vulnerable to a classic AES-CBC bitflip attack. You can flip the IV and generate locally valid tokens. To patch, change encryption mode of operation (maybe with an authenticated one).

[Full exploit here](service2-bitflip.py)
